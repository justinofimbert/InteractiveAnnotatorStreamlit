{"ast":null,"code":"import _slicedToArray from\"/home/DigPatho/Streamlit-Image-Annotation/streamlit_image_annotation/Point/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Streamlit,withStreamlitConnection}from\"streamlit-component-lib\";import React,{useEffect,useState}from\"react\";import{ChakraProvider,Select,Box,Spacer,HStack,Center,Text}from'@chakra-ui/react';import useImage from'use-image';import ThemeSwitcher from'./ThemeSwitcher';import PointCanvas from\"./PointCanvas\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";/**\n * This is a React-based component template. The `render()` function is called\n * automatically when your component should be re-rendered.\n */var PointDet=function PointDet(_ref){var args=_ref.args,theme=_ref.theme;var image_url=args.image_url,image_size=args.image_size,label_list=args.label_list,points_info=args.points_info,color_map=args.color_map,point_width=args.point_width,use_space=args.use_space,mode=args.mode;var params=new URLSearchParams(window.location.search);var baseUrl=params.get('streamlitUrl');var _useImage=useImage(baseUrl+image_url),_useImage2=_slicedToArray(_useImage,1),image=_useImage2[0];var _React$useState=React.useState(points_info.map(function(p,i){return{x:p.point[0],y:p.point[1],label:p.label,stroke:color_map[p.label],id:'point-'+i};})),_React$useState2=_slicedToArray(_React$useState,2),pointsInfo=_React$useState2[0],setPointsInfo=_React$useState2[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),selectedId=_React$useState4[0],setSelectedId=_React$useState4[1];var _useState=useState(label_list[0]),_useState2=_slicedToArray(_useState,2),label=_useState2[0],setLabel=_useState2[1];var handleClassSelectorChange=function handleClassSelectorChange(event){setLabel(event.target.value);if(!(selectedId===null)){var points=pointsInfo.slice();for(var i=0;i<points.length;i++){if(points[i].id===selectedId){points[i].label=event.target.value;points[i].stroke=color_map[points[i].label];}}setPointsInfo(points);}};var _useState3=useState(1.0),_useState4=_slicedToArray(_useState3,2),scale=_useState4[0],setScale=_useState4[1];useEffect(function(){var resizeCanvas=function resizeCanvas(){var scale_ratio=window.innerWidth*0.8/image_size[0];setScale(Math.min(scale_ratio,1.0));Streamlit.setFrameHeight(image_size[1]*Math.min(scale_ratio,1.0));};window.addEventListener('resize',resizeCanvas);resizeCanvas();},[image_size]);useEffect(function(){var handleKeyPress=function handleKeyPress(event){if(use_space&&event.key===' '){var currentPointsValue=pointsInfo.map(function(point,i){return{point:[point.x,point.y],label_id:label_list.indexOf(point.label),label:point.label};});Streamlit.setComponentValue(currentPointsValue);}};window.addEventListener('keydown',handleKeyPress);return function(){window.removeEventListener('keydown',handleKeyPress);};},[pointsInfo]);useEffect(function(){var interval=setInterval(function(){var currentPointsValue=pointsInfo.map(function(point,i){return{point:[point.x,point.y],label_id:label_list.indexOf(point.label),label:point.label};});Streamlit.setComponentValue(currentPointsValue);},500);return function(){return clearInterval(interval);};},[pointsInfo]);return/*#__PURE__*/_jsx(ChakraProvider,{children:/*#__PURE__*/_jsx(ThemeSwitcher,{theme:theme,children:/*#__PURE__*/_jsx(Center,{children:/*#__PURE__*/_jsxs(HStack,{children:[/*#__PURE__*/_jsx(Box,{width:\"80%\",children:/*#__PURE__*/_jsx(PointCanvas,{pointsInfo:pointsInfo,mode:mode// <-- Use the mode directly from args\n,selectedId:selectedId,scale:scale,setSelectedId:setSelectedId,setPointsInfo:setPointsInfo,setLabel:setLabel,color_map:color_map,label:label,image:image,image_size:image_size,strokeWidth:point_width})}),/*#__PURE__*/_jsx(Spacer,{}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Text,{fontSize:\"sm\",children:\"Class\"}),/*#__PURE__*/_jsx(Select,{value:label,onChange:handleClassSelectorChange,children:label_list.map(function(l){return/*#__PURE__*/_jsx(\"option\",{value:l,children:l});})})]})]})})})});};export default withStreamlitConnection(PointDet);","map":{"version":3,"names":["Streamlit","withStreamlitConnection","React","useEffect","useState","ChakraProvider","Select","Box","Spacer","HStack","Center","Text","useImage","ThemeSwitcher","PointCanvas","jsx","_jsx","jsxs","_jsxs","PointDet","_ref","args","theme","image_url","image_size","label_list","points_info","color_map","point_width","use_space","mode","params","URLSearchParams","window","location","search","baseUrl","get","_useImage","_useImage2","_slicedToArray","image","_React$useState","map","p","i","x","point","y","label","stroke","id","_React$useState2","pointsInfo","setPointsInfo","_React$useState3","_React$useState4","selectedId","setSelectedId","_useState","_useState2","setLabel","handleClassSelectorChange","event","target","value","points","slice","length","_useState3","_useState4","scale","setScale","resizeCanvas","scale_ratio","innerWidth","Math","min","setFrameHeight","addEventListener","handleKeyPress","key","currentPointsValue","label_id","indexOf","setComponentValue","removeEventListener","interval","setInterval","clearInterval","children","width","strokeWidth","fontSize","onChange","l"],"sources":["/home/DigPatho/Streamlit-Image-Annotation/streamlit_image_annotation/Point/frontend/src/PointDet.tsx"],"sourcesContent":["import {\n  Streamlit,\n  withStreamlitConnection,\n  ComponentProps\n} from \"streamlit-component-lib\"\nimport React, { useEffect, useState } from \"react\"\nimport { ChakraProvider, Select, Box, Spacer, HStack, Center, Text, Button } from '@chakra-ui/react'\n\nimport useImage from 'use-image';\nimport ThemeSwitcher from './ThemeSwitcher'\nimport PointCanvas from \"./PointCanvas\";\n\nexport interface PythonArgs {\n  image_url: string,\n  image_size: number[],\n  label_list: string[],\n  points_info: any[],\n  color_map: any,\n  point_width: number,\n  use_space: boolean,\n  mode: string, // <-- Added \"mode\" to the Python arguments\n}\n\n/**\n * This is a React-based component template. The `render()` function is called\n * automatically when your component should be re-rendered.\n */\nconst PointDet = ({ args, theme }: ComponentProps) => {\n  const {\n    image_url,\n    image_size,\n    label_list,\n    points_info,\n    color_map,\n    point_width,\n    use_space,\n    mode  // <-- Extract \"mode\" from the args\n  }: PythonArgs = args\n\n  const params = new URLSearchParams(window.location.search);\n  const baseUrl = params.get('streamlitUrl')\n  const [image] = useImage(baseUrl + image_url)\n  const [pointsInfo, setPointsInfo] = React.useState(\n    points_info.map((p, i) => {\n      return {\n        x: p.point[0],\n        y: p.point[1],\n        label: p.label,\n        stroke: color_map[p.label],\n        id: 'point-' + i\n      }\n    }));\n  const [selectedId, setSelectedId] = React.useState<string | null>(null);\n  const [label, setLabel] = useState(label_list[0])\n\n  const handleClassSelectorChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    setLabel(event.target.value)\n    if (!(selectedId === null)) {\n      const points = pointsInfo.slice();\n      for (let i = 0; i < points.length; i++) {\n        if (points[i].id === selectedId) {\n          points[i].label = event.target.value;\n          points[i].stroke = color_map[points[i].label]\n        }\n      }\n      setPointsInfo(points)\n    }\n  }\n\n  const [scale, setScale] = useState(1.0)\n  useEffect(() => {\n    const resizeCanvas = () => {\n      const scale_ratio = window.innerWidth * 0.8 / image_size[0]\n      setScale(Math.min(scale_ratio, 1.0))\n      Streamlit.setFrameHeight(image_size[1] * Math.min(scale_ratio, 1.0))\n    }\n    window.addEventListener('resize', resizeCanvas);\n    resizeCanvas()\n  }, [image_size])\n\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      if (use_space && event.key === ' ') { \n        const currentPointsValue = pointsInfo.map((point, i) => {\n          return {\n            point: [point.x, point.y],\n            label_id: label_list.indexOf(point.label),\n            label: point.label\n          }\n        })\n        Streamlit.setComponentValue(currentPointsValue)\n      }\n    };\n    window.addEventListener('keydown', handleKeyPress);\n    return () => {\n      window.removeEventListener('keydown', handleKeyPress);\n    };\n  }, [pointsInfo]); \n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const currentPointsValue = pointsInfo.map((point, i) => {\n        return {\n          point: [point.x, point.y],\n          label_id: label_list.indexOf(point.label),\n          label: point.label\n        }\n      })\n      Streamlit.setComponentValue(currentPointsValue)\n    }, 500); \n\n    return () => clearInterval(interval);\n  }, [pointsInfo]);\n\n\n  return (\n    <ChakraProvider>\n      <ThemeSwitcher theme={theme}>\n        <Center>\n          <HStack>\n            <Box width=\"80%\">\n              <PointCanvas\n                pointsInfo={pointsInfo}\n                mode={mode}  // <-- Use the mode directly from args\n                selectedId={selectedId}\n                scale={scale}\n                setSelectedId={setSelectedId}\n                setPointsInfo={setPointsInfo}\n                setLabel={setLabel}\n                color_map={color_map}\n                label={label}\n                image={image}\n                image_size={image_size}\n                strokeWidth={point_width}\n              />\n            </Box>\n            <Spacer />\n            <Box>\n              <Text fontSize='sm'>Class</Text>\n              <Select value={label} onChange={handleClassSelectorChange}>\n                {label_list.map(\n                  (l) =>\n                    <option value={l}>{l}</option>\n                )\n                }\n              </Select>\n            </Box>\n          </HStack>\n        </Center>\n      </ThemeSwitcher>\n    </ChakraProvider>\n  )\n\n}\n\nexport default withStreamlitConnection(PointDet)\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}