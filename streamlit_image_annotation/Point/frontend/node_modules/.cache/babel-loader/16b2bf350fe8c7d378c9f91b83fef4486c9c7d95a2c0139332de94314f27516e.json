{"ast":null,"code":"import _slicedToArray from\"/home/DigPatho/Streamlit-Image-Annotation/streamlit_image_annotation/Point/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Streamlit,withStreamlitConnection}from\"streamlit-component-lib\";import React,{useEffect,useState}from\"react\";import{ChakraProvider,Box,Spacer,HStack,Center}from'@chakra-ui/react';import useImage from'use-image';import ThemeSwitcher from'./ThemeSwitcher';import PointCanvas from\"./PointCanvas\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";/**\n * This is a React-based component template. The `render()` function is called\n * automatically when your component should be re-rendered.\n */var PointDet=function PointDet(_ref){var args=_ref.args,theme=_ref.theme;var image_url=args.image_url,image_size=args.image_size,label_list=args.label_list,points_info=args.points_info,color_map=args.color_map,point_width=args.point_width,use_space=args.use_space,mode=args.mode,label=args.label;var params=new URLSearchParams(window.location.search);var baseUrl=params.get('streamlitUrl');var _useImage=useImage(baseUrl+image_url),_useImage2=_slicedToArray(_useImage,1),image=_useImage2[0];var _React$useState=React.useState(points_info.map(function(p,i){return{x:p.point[0],y:p.point[1],label:p.label,stroke:color_map[p.label],id:'point-'+i};})),_React$useState2=_slicedToArray(_React$useState,2),pointsInfo=_React$useState2[0],setPointsInfo=_React$useState2[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),selectedId=_React$useState4[0],setSelectedId=_React$useState4[1];var _useState=useState(1.0),_useState2=_slicedToArray(_useState,2),scale=_useState2[0],setScale=_useState2[1];useEffect(function(){var resizeCanvas=function resizeCanvas(){var scale_ratio=window.innerWidth*0.8/image_size[0];setScale(Math.min(scale_ratio,1.0));Streamlit.setFrameHeight(image_size[1]*Math.min(scale_ratio,1.0));};window.addEventListener('resize',resizeCanvas);resizeCanvas();},[image_size]);useEffect(function(){var handleKeyPress=function handleKeyPress(event){if(use_space&&event.key===' '){var currentPointsValue=pointsInfo.map(function(point,i){return{point:[point.x,point.y],label_id:label_list.indexOf(point.label),label:point.label};});Streamlit.setComponentValue(currentPointsValue);}};window.addEventListener('keydown',handleKeyPress);return function(){window.removeEventListener('keydown',handleKeyPress);};},[pointsInfo]);// This effect runs only when pointsInfo changes\nuseEffect(function(){// Only set the component value when pointsInfo changes\nvar currentPointsValue=pointsInfo.map(function(point,i){return{point:[point.x,point.y],label_id:label_list.indexOf(point.label),label:point.label};});Streamlit.setComponentValue(currentPointsValue);},[pointsInfo]);// Triggered when pointsInfo changes\nreturn/*#__PURE__*/_jsx(ChakraProvider,{children:/*#__PURE__*/_jsx(ThemeSwitcher,{theme:theme,children:/*#__PURE__*/_jsx(Center,{children:/*#__PURE__*/_jsxs(HStack,{children:[/*#__PURE__*/_jsx(Box,{width:\"80%\",children:/*#__PURE__*/_jsx(PointCanvas,{pointsInfo:pointsInfo,mode:mode// <-- Use the mode directly from args\n,selectedId:selectedId,scale:scale,setSelectedId:setSelectedId,setPointsInfo:setPointsInfo,setLabel:function setLabel(){},color_map:color_map,label:label// <-- Use the label directly from args\n,image:image,image_size:image_size,strokeWidth:point_width})}),/*#__PURE__*/_jsx(Spacer,{})]})})})});};export default withStreamlitConnection(PointDet);","map":{"version":3,"names":["Streamlit","withStreamlitConnection","React","useEffect","useState","ChakraProvider","Box","Spacer","HStack","Center","useImage","ThemeSwitcher","PointCanvas","jsx","_jsx","jsxs","_jsxs","PointDet","_ref","args","theme","image_url","image_size","label_list","points_info","color_map","point_width","use_space","mode","label","params","URLSearchParams","window","location","search","baseUrl","get","_useImage","_useImage2","_slicedToArray","image","_React$useState","map","p","i","x","point","y","stroke","id","_React$useState2","pointsInfo","setPointsInfo","_React$useState3","_React$useState4","selectedId","setSelectedId","_useState","_useState2","scale","setScale","resizeCanvas","scale_ratio","innerWidth","Math","min","setFrameHeight","addEventListener","handleKeyPress","event","key","currentPointsValue","label_id","indexOf","setComponentValue","removeEventListener","children","width","setLabel","strokeWidth"],"sources":["/home/DigPatho/Streamlit-Image-Annotation/streamlit_image_annotation/Point/frontend/src/PointDet.tsx"],"sourcesContent":["import {\n  Streamlit,\n  withStreamlitConnection,\n  ComponentProps\n} from \"streamlit-component-lib\"\nimport React, { useEffect, useState } from \"react\"\nimport { ChakraProvider, Box, Spacer, HStack, Center } from '@chakra-ui/react'\n\nimport useImage from 'use-image';\nimport ThemeSwitcher from './ThemeSwitcher'\nimport PointCanvas from \"./PointCanvas\";\n\nexport interface PythonArgs {\n  image_url: string,\n  image_size: number[],\n  label_list: string[],\n  points_info: any[],\n  color_map: any,\n  point_width: number,\n  use_space: boolean,\n  mode: string,  // <-- Added \"mode\" to the Python arguments\n  label: string  // <-- Added \"label\" to the Python arguments\n}\n\n/**\n * This is a React-based component template. The `render()` function is called\n * automatically when your component should be re-rendered.\n */\nconst PointDet = ({ args, theme }: ComponentProps) => {\n  const {\n    image_url,\n    image_size,\n    label_list,\n    points_info,\n    color_map,\n    point_width,\n    use_space,\n    mode,  // <-- Extract \"mode\" from the args\n    label  // <-- Extract \"label\" from the args\n  }: PythonArgs = args\n\n  const params = new URLSearchParams(window.location.search);\n  const baseUrl = params.get('streamlitUrl')\n  const [image] = useImage(baseUrl + image_url)\n  const [pointsInfo, setPointsInfo] = React.useState(\n    points_info.map((p, i) => {\n      return {\n        x: p.point[0],\n        y: p.point[1],\n        label: p.label,\n        stroke: color_map[p.label],\n        id: 'point-' + i\n      }\n    })\n  );\n  const [selectedId, setSelectedId] = React.useState<string | null>(null);\n\n  const [scale, setScale] = useState(1.0)\n  useEffect(() => {\n    const resizeCanvas = () => {\n      const scale_ratio = window.innerWidth * 0.8 / image_size[0]\n      setScale(Math.min(scale_ratio, 1.0))\n      Streamlit.setFrameHeight(image_size[1] * Math.min(scale_ratio, 1.0))\n    }\n    window.addEventListener('resize', resizeCanvas);\n    resizeCanvas()\n  }, [image_size])\n\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      if (use_space && event.key === ' ') { \n        const currentPointsValue = pointsInfo.map((point, i) => {\n          return {\n            point: [point.x, point.y],\n            label_id: label_list.indexOf(point.label),\n            label: point.label\n          }\n        })\n        Streamlit.setComponentValue(currentPointsValue)\n      }\n    };\n    window.addEventListener('keydown', handleKeyPress);\n    return () => {\n      window.removeEventListener('keydown', handleKeyPress);\n    };\n  }, [pointsInfo]); \n\n  // This effect runs only when pointsInfo changes\n  useEffect(() => {\n    // Only set the component value when pointsInfo changes\n    const currentPointsValue = pointsInfo.map((point, i) => {\n      return {\n        point: [point.x, point.y],\n        label_id: label_list.indexOf(point.label),\n        label: point.label\n      }\n    })\n    Streamlit.setComponentValue(currentPointsValue)\n  }, [pointsInfo]); // Triggered when pointsInfo changes\n\n  return (\n    <ChakraProvider>\n      <ThemeSwitcher theme={theme}>\n        <Center>\n          <HStack>\n            <Box width=\"80%\">\n              <PointCanvas\n                pointsInfo={pointsInfo}\n                mode={mode}  // <-- Use the mode directly from args\n                selectedId={selectedId}\n                scale={scale}\n                setSelectedId={setSelectedId}\n                setPointsInfo={setPointsInfo}\n                setLabel={() => {}}\n                color_map={color_map}\n                label={label}  // <-- Use the label directly from args\n                image={image}\n                image_size={image_size}\n                strokeWidth={point_width}\n              />\n            </Box>\n            <Spacer />\n          </HStack>\n        </Center>\n      </ThemeSwitcher>\n    </ChakraProvider>\n  )\n}\n\nexport default withStreamlitConnection(PointDet)\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}