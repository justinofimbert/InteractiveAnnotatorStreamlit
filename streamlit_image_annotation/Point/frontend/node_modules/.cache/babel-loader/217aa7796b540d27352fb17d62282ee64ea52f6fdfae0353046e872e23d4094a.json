{"ast":null,"code":"import _slicedToArray from\"/home/DigPatho/Streamlit-Image-Annotation/streamlit_image_annotation/Point/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Streamlit,withStreamlitConnection}from\"streamlit-component-lib\";import React,{useEffect,useState}from\"react\";import{ChakraProvider,Select,Box,Spacer,HStack,Center,Text,Button}from'@chakra-ui/react';import useImage from'use-image';import ThemeSwitcher from'./ThemeSwitcher';import PointCanvas from\"./PointCanvas\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";/**\n * This is a React-based component template. The `render()` function is called\n * automatically when your component should be re-rendered.\n */var PointDet=function PointDet(_ref){var args=_ref.args,theme=_ref.theme;var image_url=args.image_url,image_size=args.image_size,label_list=args.label_list,points_info=args.points_info,color_map=args.color_map,point_width=args.point_width,use_space=args.use_space;var params=new URLSearchParams(window.location.search);var baseUrl=params.get('streamlitUrl');var _useImage=useImage(baseUrl+image_url),_useImage2=_slicedToArray(_useImage,1),image=_useImage2[0];var _React$useState=React.useState(points_info.map(function(p,i){return{x:p.point[0],y:p.point[1],label:p.label,stroke:color_map[p.label],id:'point-'+i};})),_React$useState2=_slicedToArray(_React$useState,2),pointsInfo=_React$useState2[0],setPointsInfo=_React$useState2[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),selectedId=_React$useState4[0],setSelectedId=_React$useState4[1];var _useState=useState(label_list[0]),_useState2=_slicedToArray(_useState,2),label=_useState2[0],setLabel=_useState2[1];var _React$useState5=React.useState('Transform'),_React$useState6=_slicedToArray(_React$useState5,2),mode=_React$useState6[0],setMode=_React$useState6[1];var handleClassSelectorChange=function handleClassSelectorChange(event){setLabel(event.target.value);console.log(selectedId);if(!(selectedId===null)){var points=pointsInfo.slice();for(var i=0;i<points.length;i++){if(points[i].id===selectedId){points[i].label=event.target.value;points[i].stroke=color_map[points[i].label];}}setPointsInfo(points);}};var _useState3=useState(1.0),_useState4=_slicedToArray(_useState3,2),scale=_useState4[0],setScale=_useState4[1];useEffect(function(){var resizeCanvas=function resizeCanvas(){var scale_ratio=window.innerWidth*0.8/image_size[0];setScale(Math.min(scale_ratio,1.0));Streamlit.setFrameHeight(image_size[1]*Math.min(scale_ratio,1.0));};window.addEventListener('resize',resizeCanvas);resizeCanvas();},[image_size]);useEffect(function(){var handleKeyPress=function handleKeyPress(event){if(use_space&&event.key===' '){// 32 is the key code for Space key\nvar currentPointsValue=pointsInfo.map(function(point,i){return{point:[point.x,point.y],label_id:label_list.indexOf(point.label),label:point.label};});Streamlit.setComponentValue(currentPointsValue);}};window.addEventListener('keydown',handleKeyPress);return function(){window.removeEventListener('keydown',handleKeyPress);};},[pointsInfo]);return/*#__PURE__*/_jsx(ChakraProvider,{children:/*#__PURE__*/_jsx(ThemeSwitcher,{theme:theme,children:/*#__PURE__*/_jsx(Center,{children:/*#__PURE__*/_jsxs(HStack,{children:[/*#__PURE__*/_jsx(Box,{width:\"80%\",children:/*#__PURE__*/_jsx(PointCanvas,{pointsInfo:pointsInfo,mode:mode,selectedId:selectedId,scale:scale,setSelectedId:setSelectedId,setPointsInfo:setPointsInfo,setLabel:setLabel,color_map:color_map,label:label,image:image,image_size:image_size,strokeWidth:point_width})}),/*#__PURE__*/_jsx(Spacer,{}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Text,{fontSize:\"sm\",children:\"Mode\"}),/*#__PURE__*/_jsx(Select,{value:mode,onChange:function onChange(e){setMode(e.target.value);},children:['Transform','Del'].map(function(m){return/*#__PURE__*/_jsx(\"option\",{value:m,children:m});})}),/*#__PURE__*/_jsx(Text,{fontSize:\"sm\",children:\"Class\"}),/*#__PURE__*/_jsx(Select,{value:label,onChange:handleClassSelectorChange,children:label_list.map(function(l){return/*#__PURE__*/_jsx(\"option\",{value:l,children:l});})}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(e){var currentPointsValue=pointsInfo.map(function(point,i){return{point:[point.x,point.y],label_id:label_list.indexOf(point.label),label:point.label};});Streamlit.setComponentValue(currentPointsValue);},children:\"Complete\"})]})]})})})});};export default withStreamlitConnection(PointDet);","map":{"version":3,"names":["Streamlit","withStreamlitConnection","React","useEffect","useState","ChakraProvider","Select","Box","Spacer","HStack","Center","Text","Button","useImage","ThemeSwitcher","PointCanvas","jsx","_jsx","jsxs","_jsxs","PointDet","_ref","args","theme","image_url","image_size","label_list","points_info","color_map","point_width","use_space","params","URLSearchParams","window","location","search","baseUrl","get","_useImage","_useImage2","_slicedToArray","image","_React$useState","map","p","i","x","point","y","label","stroke","id","_React$useState2","pointsInfo","setPointsInfo","_React$useState3","_React$useState4","selectedId","setSelectedId","_useState","_useState2","setLabel","_React$useState5","_React$useState6","mode","setMode","handleClassSelectorChange","event","target","value","console","log","points","slice","length","_useState3","_useState4","scale","setScale","resizeCanvas","scale_ratio","innerWidth","Math","min","setFrameHeight","addEventListener","handleKeyPress","key","currentPointsValue","label_id","indexOf","setComponentValue","removeEventListener","children","width","strokeWidth","fontSize","onChange","e","m","l","onClick"],"sources":["/home/DigPatho/Streamlit-Image-Annotation/streamlit_image_annotation/Point/frontend/src/PointDet.tsx"],"sourcesContent":["import {\n  Streamlit,\n  withStreamlitConnection,\n  ComponentProps\n} from \"streamlit-component-lib\"\nimport React, { useEffect, useState } from \"react\"\nimport { ChakraProvider, Select, Box, Spacer, HStack, Center, Text, Button } from '@chakra-ui/react'\n\nimport useImage from 'use-image';\nimport ThemeSwitcher from './ThemeSwitcher'\nimport PointCanvas from \"./PointCanvas\";\n\nexport interface PythonArgs {\n  image_url: string,\n  image_size: number[],\n  label_list: string[],\n  points_info: any[],\n  color_map: any,\n  point_width: number,\n  use_space: boolean,\n}\n\n/**\n * This is a React-based component template. The `render()` function is called\n * automatically when your component should be re-rendered.\n */\nconst PointDet = ({ args, theme }: ComponentProps) => {\n  const {\n    image_url,\n    image_size,\n    label_list,\n    points_info,\n    color_map,\n    point_width,\n    use_space\n  }: PythonArgs = args\n\n  const params = new URLSearchParams(window.location.search);\n  const baseUrl = params.get('streamlitUrl')\n  const [image] = useImage(baseUrl + image_url)\n  const [pointsInfo, setPointsInfo] = React.useState(\n    points_info.map((p, i) => {\n      return {\n        x: p.point[0],\n        y: p.point[1],\n        label: p.label,\n        stroke: color_map[p.label],\n        id: 'point-' + i\n      }\n    }));\n  const [selectedId, setSelectedId] = React.useState<string | null>(null);\n  const [label, setLabel] = useState(label_list[0])\n  const [mode, setMode] = React.useState<string>('Transform');\n\n  const handleClassSelectorChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    setLabel(event.target.value)\n    console.log(selectedId)\n    if (!(selectedId === null)) {\n      const points = pointsInfo.slice();\n      for (let i = 0; i < points.length; i++) {\n        if (points[i].id === selectedId) {\n          points[i].label = event.target.value;\n          points[i].stroke = color_map[points[i].label]\n        }\n      }\n      setPointsInfo(points)\n    }\n  }\n  const [scale, setScale] = useState(1.0)\n  useEffect(() => {\n    const resizeCanvas = () => {\n      const scale_ratio = window.innerWidth * 0.8 / image_size[0]\n      setScale(Math.min(scale_ratio, 1.0))\n      Streamlit.setFrameHeight(image_size[1] * Math.min(scale_ratio, 1.0))\n    }\n    window.addEventListener('resize', resizeCanvas);\n    resizeCanvas()\n  }, [image_size])\n\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      if (use_space && event.key === ' ') { // 32 is the key code for Space key\n        const currentPointsValue = pointsInfo.map((point, i) => {\n          return {\n            point: [point.x, point.y],\n            label_id: label_list.indexOf(point.label),\n            label: point.label\n          }\n        })\n        Streamlit.setComponentValue(currentPointsValue)\n      }\n    };\n    window.addEventListener('keydown', handleKeyPress);\n    return () => {\n      window.removeEventListener('keydown', handleKeyPress);\n    };\n  }, [pointsInfo]); \n\n  return (\n    <ChakraProvider>\n      <ThemeSwitcher theme={theme}>\n        <Center>\n          <HStack>\n            <Box width=\"80%\">\n              <PointCanvas\n                pointsInfo={pointsInfo}\n                mode={mode}\n                selectedId={selectedId}\n                scale={scale}\n                setSelectedId={setSelectedId}\n                setPointsInfo={setPointsInfo}\n                setLabel={setLabel}\n                color_map={color_map}\n                label={label}\n                image={image}\n                image_size={image_size}\n                strokeWidth={point_width}\n              />\n            </Box>\n            <Spacer />\n            <Box>\n              <Text fontSize='sm'>Mode</Text>\n              <Select value={mode} onChange={(e) => { setMode(e.target.value) }}>\n                {['Transform', 'Del'].map(\n                  (m) =>\n                    <option value={m}>{m}</option>\n                )}\n              </Select>\n              <Text fontSize='sm'>Class</Text>\n              <Select value={label} onChange={handleClassSelectorChange}>\n                {label_list.map(\n                  (l) =>\n                    <option value={l}>{l}</option>\n                )\n                }\n              </Select>\n\n              <Button onClick={(e) => {\n                const currentPointsValue = pointsInfo.map((point, i) => {\n                  return {\n                    point: [point.x, point.y],\n                    label_id: label_list.indexOf(point.label),\n                    label: point.label\n                  }\n                })\n                Streamlit.setComponentValue(currentPointsValue)\n              }}>Complete</Button>\n            </Box>\n          </HStack>\n        </Center>\n      </ThemeSwitcher>\n    </ChakraProvider>\n  )\n\n}\n\n\nexport default withStreamlitConnection(PointDet)\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}